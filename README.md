# rmscc2ldkcl

RMS-CloudConnected to LDK-CL Entitlement Migration Tool for Thales Sentinel EMS

## Overview

`rmscc2ldkcl` is a PowerShell-based migration tool designed to assist in the migration of entitlements from RMS-CloudConnected products to LDK-CL products within the Thales Sentinel Entitlement Management System (EMS). The tool leverages the standard REST APIs provided by Sentinel EMS to perform secure and reliable entitlement migrations.

## Features

- Automated entitlement migration from RMS-CC to LDK-CL products
- RESTful API integration with Sentinel EMS
- Two execution modes: Interactive and Batch
- Two migration modes: Staging and Complete
- Basic authentication with Sentinel EMS
- Comprehensive logging capabilities
- Error handling and validation
- Detailed migration reports

## Prerequisites

- PowerShell 5.1 or later (PowerShell 7+ recommended)
- Access to Thales Sentinel EMS instance
- Valid username and password for Sentinel EMS (basic authentication)
- Appropriate permissions to read and create entitlements
- Batch Code and Customer ID for migration operations

## Installation

1. Clone this repository:
   ```powershell
   git clone https://github.com/nickdothutton/rmscc2ldkcl.git
   cd rmscc2ldkcl
   ```

2. Ensure you have the required PowerShell version:
   ```powershell
   $PSVersionTable.PSVersion
   ```

## Usage

The script can be run in two different execution modes:

### Interactive Mode

In interactive mode, the script prompts you for all required parameters. This is ideal for one-time executions or when you prefer a guided experience.

```powershell
.\rmscc2ldkcl.ps1 -Interactive
```

The script will prompt you for:
1. Sentinel EMS URL
2. Username
3. Password (secure input - characters hidden)
4. Batch Code
5. Customer ID
6. Migration Mode (staging or complete)

After entering all parameters, you'll see a summary and be asked to confirm before proceeding.

### Batch Mode

In batch mode, all parameters must be provided via command-line arguments. This is ideal for automation, scheduled tasks, or integration with other systems.

```powershell
.\rmscc2ldkcl.ps1 `
    -EmsUrl "https://ems.example.com" `
    -Username "your-username" `
    -Password "your-password" `
    -BatchCode "BATCH001" `
    -CustomerId "CUST123" `
    -Mode "staging"
```

### Parameters

| Parameter | Required | Description |
|-----------|----------|-------------|
| `Interactive` | No | Switch to run in interactive mode (prompts for all inputs) |
| `EmsUrl` | Yes* | The base URL of your Sentinel EMS instance |
| `Username` | Yes* | Username for basic authentication with Sentinel EMS |
| `Password` | Yes* | Password for basic authentication with Sentinel EMS |
| `BatchCode` | Yes* | The batch code to identify the migration batch |
| `CustomerId` | Yes* | The customer ID for the migration |
| `Mode` | Yes* | Migration mode: 'staging' or 'complete' |
| `LogFile` | No | Path to log file (auto-generated by default) |

\* Required when not using `-Interactive` mode

### Migration Modes

#### Staging Mode
Use staging mode to prepare and validate the migration without making permanent changes.

```powershell
.\rmscc2ldkcl.ps1 `
    -EmsUrl "https://ems.example.com" `
    -Username "admin" `
    -Password "securepass123" `
    -BatchCode "BATCH001" `
    -CustomerId "CUST123" `
    -Mode "staging"
```

#### Complete Mode
Use complete mode to execute the full migration process.

```powershell
.\rmscc2ldkcl.ps1 `
    -EmsUrl "https://ems.example.com" `
    -Username "admin" `
    -Password "securepass123" `
    -BatchCode "BATCH001" `
    -CustomerId "CUST123" `
    -Mode "complete"
```

## Logging

The tool automatically creates detailed log files with timestamps for each execution:
- Default log location: `rmscc2ldkcl_YYYYMMDD_HHMMSS.log`
- Logs include timestamps, severity levels, and detailed operation information
- All API calls and results are logged for audit purposes

## Security Considerations

- Store credentials securely (consider using environment variables or secure vaults)
- Never commit passwords or credentials to version control
- Use HTTPS for all EMS connections
- In batch mode, avoid hardcoding passwords in scripts - use secure parameter passing
- Review logs for sensitive information before sharing
- Test thoroughly in a non-production environment first
- Use interactive mode when manually running the script to avoid password exposure in command history

## Workflow

1. **Parameter Collection**: Collects required parameters (interactive or batch mode)
2. **Authentication**: Establishes basic auth connection to Sentinel EMS
3. **Initialization**: Validates connection to EMS and credentials
4. **Entitlements Retrieval**: Calls Search Entitlements API (GET /ems/api/v5/entitlements) with customerId to retrieve all entitlements for the customer
5. **Mode Selection**: Executes either staging or complete mode operations
6. **Processing**: Performs migration operations using the retrieved entitlements data
7. **Reporting**: Generates detailed logs and summary of operations

## Error Handling

The tool includes comprehensive error handling:
- API connection failures
- Authentication errors
- Invalid parameters (batch code, customer ID)
- Network timeouts
- Invalid migration mode selection

All errors are logged with detailed information to facilitate troubleshooting.

## Troubleshooting

### Common Issues

**Issue**: "Failed to connect to EMS"
- **Solution**: Verify the EMS URL is correct and accessible (include https://)
- Check firewall/network settings
- Ensure the EMS instance is running

**Issue**: "Authentication failed"
- **Solution**: Verify your username and password are correct
- Ensure the account has appropriate permissions
- Check if the account is locked or expired

**Issue**: "Invalid mode"
- **Solution**: Ensure you specify either 'staging' or 'complete' for the Mode parameter
- Check for typos in the mode parameter

**Issue**: "Operation cancelled by user"
- **Solution**: This occurs when you select 'N' at the confirmation prompt in interactive mode
- Re-run the script and select 'Y' to proceed

## API Reference

This tool uses the following Sentinel EMS REST API endpoints:

- `GET /api/health` - Health check (optional, for connectivity validation)
- `GET /ems/api/v5/entitlements?customerId={customerId}` - Search/retrieve entitlements for a customer
- Additional endpoints will be used for staging and complete mode operations (to be defined)

Refer to the Thales Sentinel EMS API documentation for complete endpoint details.

## Contributing

Contributions are welcome! Please follow these guidelines:

1. Fork the repository
2. Create a feature branch
3. Make your changes with clear commit messages
4. Test thoroughly
5. Submit a pull request

## License

[Specify your license here]

## Support

For issues, questions, or contributions, please:
- Open an issue on GitHub
- Refer to Thales Sentinel EMS documentation
- Contact your Thales support representative

## Version History

### 2.0.0 (2025-10-28)
- Added interactive and batch execution modes
- Implemented staging and complete migration modes
- Changed authentication from API key to basic auth (username/password)
- Added batch code and customer ID parameters
- Enhanced user prompts and confirmation in interactive mode
- Improved parameter validation and error handling

### 1.0.0 (2025-10-28)
- Initial release
- Basic migration functionality
- REST API integration
- Logging capabilities

## Acknowledgments

- Thales Sentinel EMS team for API documentation
- PowerShell community for best practices

## Disclaimer

This tool is provided as-is. Always test in a non-production environment before using in production. Ensure you have proper backups before performing migrations.
